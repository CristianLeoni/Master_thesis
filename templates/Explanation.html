<!doctype html>
<html>
<head>
	<style>
		div{
			text-align:center;
			background-color: #f1f1f1;
		}
		#explanation_plot{
			text-align:center;
		}
		.selection {
		  stroke          : gray;
		  stroke-width    : 1px;
		  stroke-dasharray: 4px;
		  stroke-opacity  : 0.5;
		  fill            : blue;
		  fill-opacity	  : 0.2;
		}
	</style>
</head>
<body>
	<script src="https://d3js.org/d3.v4.min.js"></script>
	<script src="https://d3js.org/d3-brush.v2.min.js"></script>
	<script src="{{ url_for('static', filename='Explanation_container.js') }}"></script>
	<script src="{{ url_for('static', filename='Histogram.js') }}"></script>
	<script src="{{ url_for('static', filename='Boxplot.js') }}"></script>
	<script src="{{ url_for('static', filename='Performance_wheel.js') }}"></script>
	<script src="{{ url_for('static', filename='Scatterplot.js') }}"></script>

	<div id='summary_plot'></div>
	<div id='performace_plot'></div>
	<div id='explanation_plot'/></div>
	
    <script>
	
		function encode_params(params){
			var encoded ='?'
			for(var key in params) {
				encoded += key+'='+params[key]+'&'
			}
			return encoded.slice(0,-1);
		}
		function decode_parameters(){
			var url_params = new Object();
			var sPageURL = window.location.search.substring(1);
			var sURLVariables = sPageURL.split('&');
			for (var i = 0; i < sURLVariables.length; i++)
			{
				var sParameterName = sURLVariables[i].split('=');	
				if(sParameterName[1])
					url_params[sParameterName[0]] = sParameterName[1];
			}
			return url_params;
		}
	
		var url_params = decode_parameters();
		
		if(url_params['performances']){
			url_params['performances'].split(',').forEach((p)=>new Performance_wheel('#performace_plot',+p))
		}
		
		d3.csv('http:\\scatter_d3'+encode_params(url_params),function(data){
			console.log(url_params['D_R']);
			b = new Scatterplot('#explanation_plot',data,url_params['dataset'],url_params['D_R']);
		});

		if(url_params['selection']){
			d3.csv('http:\\elaborate_dataset_id_'+url_params['selection']+''+encode_params(url_params),function(data){
				console.log(data);
				new Explanation_container('#explanation_plot',data);
			});
		}	
    </script>
</body>





<!-- OLD CODE -->
		<!-- var payload = { -->
			<!-- a: 1, -->
			<!-- b: 2, -->
			<!-- selected: '{{params}}' -->
		<!-- }; -->

		<!-- var data = new FormData(); -->
		<!-- data.append( "json", JSON.stringify( payload ) ); -->

		<!-- fetch("/elaborate_dataset", -->
		<!-- { -->
			<!-- method: "POST", -->
			<!-- body: data -->
		<!-- }) -->
		<!-- .then(function(res){ return res.text()}) -->
		<!-- .then(function(data){  -->
			<!-- csv =  d3.csvParse(data); -->
			<!-- new Boxplot('#explanation_plot',csv); -->
			<!-- new Histogram('#explanation_plot',csv); -->
		<!-- }) -->
